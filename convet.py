import zipfile
import csv
import os

# Step 1: Extract the ZIP File
zip_file_path = "C:\\Users\\lahiru\\Downloads\\NSRL-CAID-JSONs.zip"  # Replace with the path to your ZIP file
extracted_data_folder = "extracted_data"  # Replace with the directory to extract the contents

# Ensure the extraction directory exists
if not os.path.exists(extracted_data_folder):
    os.makedirs(extracted_data_folder)

with zipfile.ZipFile(zip_file_path, "r") as zip_ref:
    zip_ref.extractall(extracted_data_folder)

# Step 2: Process Data and Convert to CSV
# Here, we assume that the data is in a plain text file.

data_file_path = os.path.join(extracted_data_folder, "NSRL-CAID-JP2.json")  # Update the filename as needed

# Read data from the text file
with open(data_file_path, "r") as data_file:
    data = data_file.readlines()

# Process the data and convert it to a list of rows (e.g., list of dictionaries)
processed_data = []
for line in data:
    # Process the line and convert it to a dictionary or list
    # Example: Split the line by a delimiter (modify based on your data format)
    parts = line.split(",")
    if len(parts) == 2:
        row = {"MalwareName": parts[0], "HashValue": parts[1]}
        processed_data.append(row)

# Step 3: Write Processed Data to a CSV File
csv_file_path = "malware_signatures.csv"  # Replace with the desired CSV file path

# Write the processed data to a CSV file
with open(csv_file_path, "w", newline="") as csv_file:
    fieldnames = ["MalwareName", "HashValue"]  # Customize field names as needed
    writer = csv.DictWriter(csv_file, fieldnames=fieldnames)

    writer.writeheader()  # Write the CSV header

    for row in processed_data:
        writer.writerow(row)

print(f"CSV file '{csv_file_path}' has been created with the extracted and processed data.")
